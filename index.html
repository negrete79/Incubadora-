<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AveproMax - Sistema de Incuba√ß√£o</title>
    <meta name="description" content="Sistema completo para controle de incuba√ß√£o de ovos">
    <meta name="theme-color" content="#2c7a7b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="AveproMax">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Vari√°veis CSS para tema de cores */
        :root {
            --primary-color: #2c7a7b;
            --secondary-color: #38b2ac;
            --accent-color: #4fd1c5;
            --background-color: #f7fafc;
            --card-background: #ffffff;
            --text-color: #2d3748;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --sidebar-width: 280px;
            --header-height: 60px;
            --transition-speed: 0.3s;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --footer-height: 50px;
        }

        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Prote√ß√£o contra c√≥pia */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: var(--footer-height);
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo-emoji {
            font-size: 2.5rem;
            animation: pulse 2s infinite;
            cursor: pointer;
            transition: transform var(--transition-speed);
        }

        .logo-emoji:hover {
            transform: scale(1.2) rotate(10deg);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .menu-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: background-color var(--transition-speed);
        }

        .menu-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background-color: var(--card-background);
            box-shadow: var(--shadow);
            transform: translateX(-100%);
            transition: transform var(--transition-speed);
            z-index: 999;
            overflow-y: auto;
            padding: 20px 0;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-link {
            display: block;
            padding: 15px 20px;
            color: var(--text-color);
            text-decoration: none;
            transition: background-color var(--transition-speed);
            border-left: 3px solid transparent;
        }

        .sidebar-link:hover {
            background-color: rgba(0, 0, 0, 0.05);
            border-left-color: var(--primary-color);
        }

        .sidebar-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main {
            margin-top: var(--header-height);
            padding: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .section {
            margin-bottom: 40px;
            scroll-margin-top: calc(var(--header-height) + 20px);
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Cards */
        .card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform var(--transition-speed);
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Species Grid */
        .species-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .species-card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .species-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .species-card.selected {
            border: 2px solid var(--primary-color);
        }

        .species-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .species-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .species-period {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Form */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 122, 123, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            cursor: pointer;
            transition: background-color var(--transition-speed);
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2a6a6b;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #319a95;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #e53e3e;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #dd6b20;
        }

        /* Incubation Cards */
        .incubation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .incubation-card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
        }

        .incubation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .incubation-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .incubation-species {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .incubation-progress {
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .incubation-progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.5s ease;
        }

        .incubation-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .incubation-params {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .param-tag {
            background-color: rgba(44, 122, 123, 0.1);
            color: var(--primary-color);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .incubation-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
            min-width: 300px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }

        .toast-error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-success .toast-icon {
            color: var(--success-color);
        }

        .toast-warning .toast-icon {
            color: var(--warning-color);
        }

        .toast-error .toast-icon {
            color: var(--danger-color);
        }

        .toast-close {
            margin-left: auto;
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Stages */
        .stages-list {
            margin-top: 15px;
        }

        .stage-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stage-item:last-child {
            border-bottom: none;
        }

        .stage-name {
            font-weight: 500;
        }

        .stage-day {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Footer */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--footer-height);
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 0.9rem;
        }

        .footer-link {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: opacity var(--transition-speed);
        }

        .footer-link:hover {
            opacity: 0.8;
        }

        /* Real-time Monitor */
        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .monitor-card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
            text-align: center;
        }

        .monitor-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .monitor-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .monitor-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .monitor-status.good {
            background-color: var(--success-color);
        }

        .monitor-status.warning {
            background-color: var(--warning-color);
        }

        .monitor-status.danger {
            background-color: var(--danger-color);
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .species-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .incubation-grid {
                grid-template-columns: 1fr;
            }
            
            .monitor-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .footer-content {
                flex-direction: column;
                gap: 5px;
                font-size: 0.8rem;
            }
            
            .incubation-actions {
                justify-content: center;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-text {
            margin-bottom: 20px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed), visibility var(--transition-speed);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform var(--transition-speed);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Alarm Indicator */
        .alarm-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--danger-color);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 1003;
            display: none;
            text-align: center;
            animation: pulse 1s infinite;
        }

        .alarm-indicator.active {
            display: block;
        }

        .alarm-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .alarm-message {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .alarm-stop {
            background-color: white;
            color: var(--danger-color);
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: bold;
            cursor: pointer;
        }

        /* PWA Install Button */
        .install-button {
            position: fixed;
            bottom: 70px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 99;
            transition: all var(--transition-speed);
        }

        .install-button:hover {
            transform: scale(1.1);
            background-color: #2a6a6b;
        }

        .install-button i {
            font-size: 1.5rem;
        }

        /* Emoji Selection Styles */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .emoji-option {
            font-size: 2.5rem;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            transition: all var(--transition-speed);
            text-align: center;
        }

        .emoji-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(44, 122, 123, 0.05);
            transform: scale(1.05);
        }

        .emoji-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(44, 122, 123, 0.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <span class="logo-emoji" id="logoEmoji">ü•ö</span>
            <span>AveproMax</span>
        </div>
        <button class="menu-button" id="menuButton" aria-label="Menu">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <a href="#species" class="sidebar-link" data-section="species">
            <i class="fas fa-egg"></i> Esp√©cies
        </a>
        <a href="#incubator" class="sidebar-link" data-section="incubator">
            <i class="fas fa-thermometer-half"></i> Incubadora
        </a>
        <a href="#realtime-monitor" class="sidebar-link" data-section="realtime-monitor">
            <i class="fas fa-tachometer-alt"></i> Monitor em Tempo Real
        </a>
        <a href="#active-incubations" class="sidebar-link" data-section="active-incubations">
            <i class="fas fa-clock"></i> Incuba√ß√µes Ativas
        </a>
        <a href="#" class="sidebar-link" id="changeEmojiLink">
            <i class="fas fa-smile"></i> Trocar Emoji
        </a>
        <a href="#" class="sidebar-link" id="resetLink">
            <i class="fas fa-redo"></i> Resetar Sistema
        </a>
    </aside>

    <!-- Main Content -->
    <main class="main">
        <!-- Species Section -->
        <section id="species" class="section">
            <h2 class="section-title">
                <i class="fas fa-egg"></i> Esp√©cies
            </h2>
            <div class="card">
                <div class="species-grid" id="speciesGrid">
                    <!-- Species cards will be dynamically generated here -->
                </div>
            </div>
        </section>

        <!-- Incubator Section -->
        <section id="incubator" class="section">
            <h2 class="section-title">
                <i class="fas fa-thermometer-half"></i> Incubadora
            </h2>
            <div class="card" id="incubatorCard">
                <div class="card-header">
                    <h3 class="card-title">Nova Incuba√ß√£o</h3>
                </div>
                <div id="incubatorContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                        <p class="empty-state-text">Selecione uma esp√©cie acima para come√ßar</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Real-time Monitor Section -->
        <section id="realtime-monitor" class="section">
            <h2 class="section-title">
                <i class="fas fa-tachometer-alt"></i> Monitor em Tempo Real
            </h2>
            <div class="card">
                <div class="monitor-grid" id="monitorGrid">
                    <!-- Monitor cards will be dynamically generated here -->
                </div>
                <div class="chart-container">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Active Incubations Section -->
        <section id="active-incubations" class="section">
            <h2 class="section-title">
                <i class="fas fa-clock"></i> Incuba√ß√µes Ativas
            </h2>
            <div class="card">
                <div class="incubation-grid" id="activeIncubations">
                    <!-- Active incubation cards will be dynamically generated here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span>Criado por Elias Costa Negret's</span>
            <a href="https://t.me/avepromax" target="_blank" class="footer-link" rel="noopener noreferrer">
                <i class="fab fa-telegram-plane"></i> Telegram
            </a>
        </div>
    </footer>

    <!-- PWA Install Button -->
    <button class="install-button" id="installButton" style="display: none;" aria-label="Instalar aplicativo">
        <i class="fas fa-download"></i>
    </button>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Alarm Indicator -->
    <div class="alarm-indicator" id="alarmIndicator">
        <div class="alarm-icon">
            <i class="fas fa-bell"></i>
        </div>
        <div class="alarm-message" id="alarmMessage">Alarme!</div>
        <button class="alarm-stop" id="alarmStop">Parar Alarme</button>
    </div>

    <!-- Reset Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal" role="dialog" aria-labelledby="resetModalTitle">
            <div class="modal-header">
                <h3 class="modal-title" id="resetModalTitle">Resetar Sistema</h3>
                <button class="modal-close" id="resetModalClose" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja resetar o sistema? Esta a√ß√£o ir√° apagar todas as incuba√ß√µes e configura√ß√µes.</p>
                <div class="form-group">
                    <label class="form-label" for="resetPassword">Digite a senha para confirmar:</label>
                    <input type="password" class="form-input" id="resetPassword" placeholder="Senha">
                </div>
                <p style="color: var(--warning-color); font-size: 0.9rem; margin-top: 10px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Nota de seguran√ßa:</strong> Esta √© uma senha de demonstra√ß√£o apenas. Em um ambiente de produ√ß√£o, use autentica√ß√£o adequada.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="resetCancel">Cancelar</button>
                <button class="btn btn-danger" id="resetConfirm">Resetar</button>
            </div>
        </div>
    </div>

    <!-- Change Emoji Modal -->
    <div class="modal-overlay" id="changeEmojiModal">
        <div class="modal" role="dialog" aria-labelledby="changeEmojiModalTitle">
            <div class="modal-header">
                <h3 class="modal-title" id="changeEmojiModalTitle">Trocar Emoji do Sistema</h3>
                <button class="modal-close" id="changeEmojiModalClose" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Selecione um emoji:</label>
                    <div class="emoji-grid">
                        <button class="emoji-option" data-emoji="ü•ö">ü•ö</button>
                        <button class="emoji-option" data-emoji="üê£">üê£</button>
                        <button class="emoji-option" data-emoji="üê§">üê§</button>
                        <button class="emoji-option" data-emoji="üê•">üê•</button>
                        <button class="emoji-option" data-emoji="ü¶Ü">ü¶Ü</button>
                        <button class="emoji-option" data-emoji="ü¶É">ü¶É</button>
                        <button class="emoji-option" data-emoji="ü¶¢">ü¶¢</button>
                        <button class="emoji-option" data-emoji="ü¶ö">ü¶ö</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="changeEmojiCancel">Cancelar</button>
                <button class="btn btn-primary" id="changeEmojiSave">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Incubation Details Modal -->
    <div class="modal-overlay" id="incubationDetailsModal">
        <div class="modal" role="dialog" aria-labelledby="incubationDetailsModalTitle">
            <div class="modal-header">
                <h3 class="modal-title" id="incubationDetailsModalTitle">Detalhes da Incuba√ß√£o</h3>
                <button class="modal-close" id="incubationDetailsModalClose" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="incubationDetailsContent">
                <!-- Details will be dynamically generated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="incubationDetailsClose">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Edit Incubation Modal -->
    <div class="modal-overlay" id="editIncubationModal">
        <div class="modal" role="dialog" aria-labelledby="editIncubationModalTitle">
            <div class="modal-header">
                <h3 class="modal-title" id="editIncubationModalTitle">Editar Incuba√ß√£o</h3>
                <button class="modal-close" id="editIncubationModalClose" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="editIncubationContent">
                <!-- Edit form will be dynamically generated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="editIncubationCancel">Cancelar</button>
                <button class="btn btn-primary" id="editIncubationSave">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // Prote√ß√£o contra c√≥pia
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        document.addEventListener('dragstart', e => e.preventDefault());
        document.addEventListener('copy', e => e.preventDefault());
        document.addEventListener('cut', e => e.preventDefault());
        document.addEventListener('paste', e => e.preventDefault());
        
        // Desabilitar atalhos de teclado
        document.addEventListener('keydown', e => {
            if (e.keyCode === 123) { // F12
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.keyCode === 85) { // Ctrl+U
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode === 73) { // Ctrl+Shift+I
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode === 74) { // Ctrl+Shift+J
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.keyCode === 83) { // Ctrl+S
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.keyCode === 65) { // Ctrl+A
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.keyCode === 67) { // Ctrl+C
                e.preventDefault();
                return false;
            }
        });

        // Dados das esp√©cies
        const speciesData = [
            {
                id: 'chicken',
                name: 'Galinha',
                icon: 'üêî',
                duration: 21,
                temperature: '37.5¬∞C',
                humidity: '60%',
                turning: '3x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de temperatura', day: 3 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Segundo ovosc√≥pio', day: 14 },
                    { name: 'Transfer√™ncia para nascedouro', day: 18 },
                    { name: 'Eclos√£o', day: 21 }
                ]
            },
            {
                id: 'duck',
                name: 'Pato',
                icon: 'ü¶Ü',
                duration: 28,
                temperature: '37.5¬∞C',
                humidity: '55-60%',
                turning: '3-4x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de umidade', day: 4 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Resfriamento di√°rio', day: 10 },
                    { name: 'Segundo ovosc√≥pio', day: 14 },
                    { name: 'Terceiro ovosc√≥pio', day: 21 },
                    { name: 'Transfer√™ncia para nascedouro', day: 25 },
                    { name: 'Eclos√£o', day: 28 }
                ]
            },
            {
                id: 'quail',
                name: 'Codorna',
                icon: 'üê§',
                duration: 17,
                temperature: '37.5¬∞C',
                humidity: '60-70%',
                turning: '2x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de temperatura', day: 3 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Segundo ovosc√≥pio', day: 12 },
                    { name: 'Transfer√™ncia para nascedouro', day: 15 },
                    { name: 'Eclos√£o', day: 17 }
                ]
            },
            {
                id: 'turkey',
                name: 'Peru',
                icon: 'ü¶É',
                duration: 28,
                temperature: '37.5¬∞C',
                humidity: '55-60%',
                turning: '3-4x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de umidade', day: 4 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Resfriamento di√°rio', day: 10 },
                    { name: 'Segundo ovosc√≥pio', day: 14 },
                    { name: 'Terceiro ovosc√≥pio', day: 21 },
                    { name: 'Transfer√™ncia para nascedouro', day: 25 },
                    { name: 'Eclos√£o', day: 28 }
                ]
            },
            {
                id: 'goose',
                name: 'Ganso',
                icon: 'ü™ø',
                duration: 30,
                temperature: '37.5¬∞C',
                humidity: '55-60%',
                turning: '3-4x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de umidade', day: 4 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Resfriamento di√°rio', day: 10 },
                    { name: 'Segundo ovosc√≥pio', day: 15 },
                    { name: 'Terceiro ovosc√≥pio', day: 22 },
                    { name: 'Transfer√™ncia para nascedouro', day: 27 },
                    { name: 'Eclos√£o', day: 30 }
                ]
            },
            {
                id: 'swan',
                name: 'Cisne',
                icon: 'ü¶¢',
                duration: 35,
                temperature: '37.5¬∞C',
                humidity: '60-65%',
                turning: '3-4x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de temperatura', day: 3 },
                    { name: 'Primeiro ovosc√≥pio', day: 10 },
                    { name: 'Segundo ovosc√≥pio', day: 20 },
                    { name: 'Terceiro ovosc√≥pio', day: 30 },
                    { name: 'Transfer√™ncia para nascedouro', day: 32 },
                    { name: 'Eclos√£o', day: 35 }
                ]
            },
            {
                id: 'peacock',
                name: 'Pav√£o',
                icon: 'ü¶ö',
                duration: 28,
                temperature: '37.2¬∞C',
                humidity: '60%',
                turning: '3-4x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de temperatura', day: 3 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Segundo ovosc√≥pio', day: 14 },
                    { name: 'Terceiro ovosc√≥pio', day: 21 },
                    { name: 'Transfer√™ncia para nascedouro', day: 25 },
                    { name: 'Eclos√£o', day: 28 }
                ]
            },
            {
                id: 'pheasant',
                name: 'Fais√£o',
                icon: 'üêì',
                duration: 25,
                temperature: '37.5¬∞C',
                humidity: '55-60%',
                turning: '3-4x ao dia',
                stages: [
                    { name: 'Configura√ß√£o inicial', day: 0 },
                    { name: 'Primeira viragem', day: 1 },
                    { name: 'Controle de umidade', day: 3 },
                    { name: 'Primeiro ovosc√≥pio', day: 7 },
                    { name: 'Segundo ovosc√≥pio', day: 14 },
                    { name: 'Transfer√™ncia para nascedouro', day: 22 },
                    { name: 'Eclos√£o', day: 25 }
                ]
            }
        ];

        // Vari√°veis globais
        let selectedSpecies = null;
        let incubations = [];
        let progressChart = null;
        let currentEditingIncubation = null;
        let selectedEmoji = 'ü•ö';

        // Sons usando Howler.js
        const sounds = {
            notification: new Howl({
                src: ['data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqPk5eZmJqcnKOio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/AAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJicoKSorLC0uLzAxMjM0NTY3ODk6Ozw9Pj9AQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpbXF1eX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8='],
                volume: 0.5
            }),
            alarm: new Howl({
                src: ['data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA='],
                volume: 1.0,
                loop: true
            })
        };

        // PWA - Bot√£o de instala√ß√£o
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        // Verificar se o app j√° est√° instalado
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('App j√° est√° instalado no modo standalone');
            installButton.style.display = 'none';
        } else {
            // Mostrar bot√£o de instala√ß√£o se o navegador suportar
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installButton.style.display = 'flex';
                
                installButton.addEventListener('click', () => {
                    installButton.style.display = 'none';
                    deferredPrompt.prompt();
                    
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('Usu√°rio aceitou a instala√ß√£o');
                            showToast('Aplicativo instalado com sucesso!', 'success');
                        } else {
                            console.log('Usu√°rio recusou a instala√ß√£o');
                            installButton.style.display = 'flex';
                        }
                        deferredPrompt = null;
                    });
                });
            });
            
            // Se o evento n√£o for acionado em 5 segundos, mostrar o bot√£o manualmente
            setTimeout(() => {
                if (!deferredPrompt) {
                    installButton.style.display = 'flex';
                }
            }, 5000);
        }

        window.addEventListener('appinstalled', () => {
            installButton.style.display = 'none';
            console.log('PWA foi instalado');
            showToast('Aplicativo instalado com sucesso!', 'success');
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar dados do localStorage
            loadFromLocalStorage();
            
            // Atualizar emoji do logo
            updateLogoEmoji();
            
            // Renderizar esp√©cies
            renderSpecies();
            
            // Renderizar incuba√ß√µes ativas
            renderActiveIncubations();
            
            // Renderizar monitor em tempo real
            renderRealtimeMonitor();
            
            // Configurar eventos
            setupEventListeners();
            
            // Verificar notifica√ß√µes
            checkNotifications();
            
            // Iniciar verifica√ß√£o peri√≥dica de notifica√ß√µes
            setInterval(checkNotifications, 60000);
            
            // Iniciar atualiza√ß√£o do monitor em tempo real
            setInterval(updateRealtimeMonitor, 5000);
        });

        // Carregar dados do localStorage
        function loadFromLocalStorage() {
            const savedIncubations = localStorage.getItem('incubations');
            if (savedIncubations) {
                incubations = JSON.parse(savedIncubations);
            }
            
            const savedEmoji = localStorage.getItem('widgetEmoji');
            if (savedEmoji) {
                selectedEmoji = savedEmoji;
            }
        }

        // Salvar dados no localStorage
        function saveToLocalStorage() {
            localStorage.setItem('incubations', JSON.stringify(incubations));
            localStorage.setItem('widgetEmoji', selectedEmoji);
        }

        // Atualizar emoji do logo
        function updateLogoEmoji() {
            const logoEmoji = document.getElementById('logoEmoji');
            if (logoEmoji) {
                logoEmoji.textContent = selectedEmoji;
                // For√ßar uma atualiza√ß√£o visual
                logoEmoji.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    logoEmoji.style.transform = 'scale(1)';
                }, 200);
            }
        }

        // Renderizar esp√©cies
        function renderSpecies() {
            const speciesGrid = document.getElementById('speciesGrid');
            speciesGrid.innerHTML = '';
            
            speciesData.forEach(species => {
                const speciesCard = document.createElement('div');
                speciesCard.className = 'species-card';
                speciesCard.dataset.speciesId = species.id;
                
                speciesCard.innerHTML = `
                    <div class="species-icon">${species.icon}</div>
                    <div class="species-name">${species.name}</div>
                    <div class="species-period">${species.duration} dias</div>
                `;
                
                speciesCard.addEventListener('click', () => selectSpecies(species.id));
                speciesGrid.appendChild(speciesCard);
            });
        }

        // Selecionar esp√©cie
        function selectSpecies(speciesId) {
            // Remover sele√ß√£o anterior
            document.querySelectorAll('.species-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Adicionar sele√ß√£o √† esp√©cie atual
            const selectedCard = document.querySelector(`.species-card[data-species-id="${speciesId}"]`);
            selectedCard.classList.add('selected');
            
            // Salvar esp√©cie selecionada
            selectedSpecies = speciesData.find(species => species.id === speciesId);
            
            // Renderizar formul√°rio de incuba√ß√£o
            renderIncubatorForm();
            
            // Rolar para a se√ß√£o da incubadora
            scrollToSection('incubator');
        }

        // Renderizar formul√°rio de incuba√ß√£o
        function renderIncubatorForm() {
            const incubatorContent = document.getElementById('incubatorContent');
            
            // Calcular data padr√£o (dura√ß√£o da incuba√ß√£o)
            const defaultHatchDate = new Date();
            defaultHatchDate.setDate(defaultHatchDate.getDate() + selectedSpecies.duration);
            const formattedDate = defaultHatchDate.toISOString().split('T')[0];
            
            incubatorContent.innerHTML = `
                <form id="incubationForm">
                    <div class="form-group">
                        <label class="form-label" for="batchName">Nome do Lote (opcional):</label>
                        <input type="text" class="form-input" id="batchName" placeholder="Ex: Lote 01/2023">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="eggQuantity">Quantidade de Ovos:</label>
                        <input type="number" class="form-input" id="eggQuantity" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="hatchDate">Data Prevista para Eclos√£o:</label>
                        <input type="date" class="form-input" id="hatchDate" value="${formattedDate}" required>
                        <small style="color: var(--text-secondary); font-size: 0.8rem;">Data prevista para a eclos√£o dos ovos</small>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Resumo da Incuba√ß√£o</h3>
                        </div>
                        <div class="form-group">
                            <p><strong>Esp√©cie:</strong> ${selectedSpecies.icon} ${selectedSpecies.name}</p>
                            <p><strong>Dura√ß√£o:</strong> ${selectedSpecies.duration} dias</p>
                            <p><strong>Temperatura:</strong> ${selectedSpecies.temperature}</p>
                            <p><strong>Umidade:</strong> ${selectedSpecies.humidity}</p>
                            <p><strong>Viragem:</strong> ${selectedSpecies.turning}</p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Est√°gios:</label>
                            <div class="stages-list">
                                ${selectedSpecies.stages.map(stage => `
                                    <div class="stage-item">
                                        <span class="stage-name">${stage.name}</span>
                                        <span class="stage-day">Dia ${stage.day}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelIncubation">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Iniciar Incuba√ß√£o</button>
                    </div>
                </form>
            `;
            
            // Configurar eventos do formul√°rio
            document.getElementById('incubationForm').addEventListener('submit', startIncubation);
            document.getElementById('cancelIncubation').addEventListener('click', () => {
                document.getElementById('incubatorContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                        <p class="empty-state-text">Selecione uma esp√©cie acima para come√ßar</p>
                    </div>
                `;
                document.querySelectorAll('.species-card').forEach(card => {
                    card.classList.remove('selected');
                });
                selectedSpecies = null;
            });
        }

        // Iniciar incuba√ß√£o
        function startIncubation(e) {
            e.preventDefault();
            
            const batchName = document.getElementById('batchName').value || `${selectedSpecies.name} ${new Date().toLocaleDateString()}`;
            const eggQuantity = parseInt(document.getElementById('eggQuantity').value);
            const hatchDate = document.getElementById('hatchDate').value;
            
            // Criar nova incuba√ß√£o
            const newIncubation = {
                id: Date.now().toString(),
                species: selectedSpecies.id,
                speciesName: selectedSpecies.name,
                speciesIcon: selectedSpecies.icon,
                batchName,
                eggQuantity,
                startDate: new Date().toISOString(),
                hatchDate: hatchDate,
                duration: selectedSpecies.duration,
                temperature: selectedSpecies.temperature,
                humidity: selectedSpecies.humidity,
                turning: selectedSpecies.turning,
                stages: selectedSpecies.stages,
                notifiedStages: [],
                active: true,
                currentTemp: parseFloat(selectedSpecies.temperature),
                currentHumidity: parseInt(selectedSpecies.humidity),
                turningStatus: true,
                lastTurning: new Date().toISOString()
            };
            
            // Adicionar √† lista de incuba√ß√µes
            incubations.push(newIncubation);
            
            // Salvar no localStorage
            saveToLocalStorage();
            
            // Exibir notifica√ß√£o
            showToast('Incuba√ß√£o iniciada com sucesso!', 'success');
            
            // Limpar formul√°rio
            document.getElementById('incubatorContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <p class="empty-state-text">Selecione uma esp√©cie acima para come√ßar</p>
                </div>
            `;
            document.querySelectorAll('.species-card').forEach(card => {
                card.classList.remove('selected');
            });
            selectedSpecies = null;
            
            // Renderizar incuba√ß√µes ativas
            renderActiveIncubations();
            
            // Renderizar monitor em tempo real
            renderRealtimeMonitor();
            
            // Rolar para a se√ß√£o de incuba√ß√µes ativas
            scrollToSection('active-incubations');
        }

        // Renderizar monitor em tempo real
        function renderRealtimeMonitor() {
            const monitorGrid = document.getElementById('monitorGrid');
            const activeIncubations = incubations.filter(incubation => incubation.active);
            
            if (activeIncubations.length === 0) {
                monitorGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <p class="empty-state-text">Nenhuma incuba√ß√£o ativa para monitorar</p>
                    </div>
                `;
                
                if (progressChart) {
                    progressChart.destroy();
                    progressChart = null;
                }
                return;
            }
            
            monitorGrid.innerHTML = '';
            
            // Calcular m√©dias
            let avgTemp = 0;
            let avgHumidity = 0;
            let totalEggs = 0;
            let turningActive = 0;
            
            activeIncubations.forEach(incubation => {
                avgTemp += incubation.currentTemp;
                avgHumidity += incubation.currentHumidity;
                totalEggs += incubation.eggQuantity;
                if (incubation.turningStatus) turningActive++;
            });
            
            avgTemp = (avgTemp / activeIncubations.length).toFixed(1);
            avgHumidity = Math.round(avgHumidity / activeIncubations.length);
            
            // Criar cards do monitor
            const monitorCards = [
                {
                    label: 'Temperatura M√©dia',
                    value: `${avgTemp}¬∞C`,
                    status: avgTemp >= 37 && avgTemp <= 38 ? 'good' : (avgTemp >= 36 && avgTemp <= 39 ? 'warning' : 'danger'),
                    icon: 'fas fa-thermometer-half'
                },
                {
                    label: 'Umidade M√©dia',
                    value: `${avgHumidity}%`,
                    status: avgHumidity >= 50 && avgHumidity <= 70 ? 'good' : (avgHumidity >= 40 && avgHumidity <= 80 ? 'warning' : 'danger'),
                    icon: 'fas fa-tint'
                },
                {
                    label: 'Total de Ovos',
                    value: totalEggs,
                    status: 'good',
                    icon: 'fas fa-egg'
                },
                {
                    label: 'Viragem Ativa',
                    value: `${turningActive}/${activeIncubations.length}`,
                    status: turningActive === activeIncubations.length ? 'good' : 'warning',
                    icon: 'fas fa-sync-alt'
                }
            ];
            
            monitorCards.forEach(card => {
                const monitorCard = document.createElement('div');
                monitorCard.className = 'monitor-card';
                
                monitorCard.innerHTML = `
                    <i class="${card.icon}" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 10px;"></i>
                    <div class="monitor-value">${card.value}</div>
                    <div class="monitor-label">
                        <span class="monitor-status ${card.status}"></span>
                        ${card.label}
                    </div>
                `;
                
                monitorGrid.appendChild(monitorCard);
            });
            
            // Atualizar gr√°fico de progresso
            updateProgressChart();
        }

        // Atualizar monitor em tempo real
        function updateRealtimeMonitor() {
            const activeIncubations = incubations.filter(incubation => incubation.active);
            
            if (activeIncubations.length === 0) return;
            
            // Simular varia√ß√£o de temperatura e umidade
            activeIncubations.forEach(incubation => {
                // Varia√ß√£o de temperatura (-0.2 a +0.2)
                const tempVariation = (Math.random() - 0.5) * 0.4;
                incubation.currentTemp = Math.max(35, Math.min(40, incubation.currentTemp + tempVariation));
                
                // Varia√ß√£o de umidade (-2 a +2)
                const humidityVariation = Math.floor((Math.random() - 0.5) * 4);
                incubation.currentHumidity = Math.max(40, Math.min(80, incubation.currentHumidity + humidityVariation));
                
                // Simular viragem a cada 8 horas
                const lastTurning = new Date(incubation.lastTurning);
                const now = new Date();
                const hoursSinceLastTurning = (now - lastTurning) / (1000 * 60 * 60);
                
                if (hoursSinceLastTurning >= 8) {
                    incubation.turningStatus = true;
                    incubation.lastTurning = now.toISOString();
                    
                    // Desativar viragem ap√≥s 1 minuto (simula√ß√£o)
                    setTimeout(() => {
                        incubation.turningStatus = false;
                        saveToLocalStorage();
                    }, 60000);
                }
            });
            
            // Salvar altera√ß√µes
            saveToLocalStorage();
            
            // Renderizar monitor novamente
            renderRealtimeMonitor();
        }

        // Atualizar gr√°fico de progresso
        function updateProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            const activeIncubations = incubations.filter(incubation => incubation.active);
            
            if (activeIncubations.length === 0) {
                if (progressChart) {
                    progressChart.destroy();
                    progressChart = null;
                }
                return;
            }
            
            // Preparar dados para o gr√°fico
            const labels = activeIncubations.map(inc => inc.batchName);
            const data = activeIncubations.map(inc => {
                const startDate = new Date(inc.startDate);
                const currentDate = new Date();
                const daysPassed = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
                return Math.min(100, Math.floor(daysPassed / inc.duration * 100));
            });
            
            // Destruir gr√°fico anterior se existir
            if (progressChart) {
                progressChart.destroy();
            }
            
            // Criar novo gr√°fico
            progressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Progresso da Incuba√ß√£o (%)',
                        data: data,
                        backgroundColor: 'rgba(79, 209, 197, 0.5)',
                        borderColor: 'rgba(79, 209, 197, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Progresso: ' + context.parsed.y + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Renderizar incuba√ß√µes ativas
        function renderActiveIncubations() {
            const activeIncubationsContainer = document.getElementById('activeIncubations');
            const activeIncubations = incubations.filter(incubation => incubation.active);
            
            if (activeIncubations.length === 0) {
                activeIncubationsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-egg"></i>
                        </div>
                        <p class="empty-state-text">Nenhuma incuba√ß√£o ativa no momento</p>
                    </div>
                `;
                return;
            }
            
            activeIncubationsContainer.innerHTML = '';
            
            activeIncubations.forEach(incubation => {
                const species = speciesData.find(s => s.id === incubation.species);
                
                // Calcular dias passados e restantes
                const startDate = new Date(incubation.startDate);
                const currentDate = new Date();
                const daysPassed = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
                
                // Garantir que daysRemaining n√£o seja negativo
                let daysRemaining = Math.max(0, incubation.duration - daysPassed);
                
                // Calcular progresso
                let progress;
                if (incubation.duration > 0) {
                    progress = Math.min(100, Math.floor(daysPassed / incubation.duration * 100));
                } else {
                    progress = daysPassed > 0 ? 100 : 0;
                }
                
                // Formatar data de eclos√£o para exibi√ß√£o
                const hatchDate = new Date(incubation.hatchDate);
                const formattedHatchDate = hatchDate.toLocaleDateString('pt-BR');
                
                const incubationCard = document.createElement('div');
                incubationCard.className = 'incubation-card';
                
                incubationCard.innerHTML = `
                    <div class="incubation-header">
                        <h3 class="incubation-title">${incubation.batchName}</h3>
                        <span>${incubation.speciesIcon}</span>
                    </div>
                    <div class="incubation-species">
                        <span>${incubation.speciesName}</span>
                        <span>${incubation.eggQuantity} ovos</span>
                    </div>
                    <div class="incubation-progress">
                        <div class="incubation-progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div class="incubation-info">
                        <span>In√≠cio: ${new Date(incubation.startDate).toLocaleDateString()}</span>
                        <span>${progress}%</span>
                    </div>
                    <div class="incubation-info">
                        <span>Dias passados: ${daysPassed}</span>
                        <span>Dias restantes: ${daysRemaining}</span>
                    </div>
                    <div class="incubation-info">
                        <span><i class="fas fa-egg-hatching"></i> Eclos√£o prevista: ${formattedHatchDate}</span>
                    </div>
                    <div class="incubation-params">
                        <span class="param-tag">${incubation.temperature}</span>
                        <span class="param-tag">${incubation.humidity}</span>
                        <span class="param-tag">${incubation.turning}</span>
                    </div>
                    <div class="incubation-actions">
                        <button type="button" class="btn btn-primary" data-id="${incubation.id}" data-action="details">
                            <i class="fas fa-info-circle"></i> Detalhes
                        </button>
                        <button type="button" class="btn btn-secondary" data-id="${incubation.id}" data-action="edit">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button type="button" class="btn btn-danger" data-id="${incubation.id}" data-action="delete">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                        <button type="button" class="btn btn-warning" data-id="${incubation.id}" data-action="complete">
                            <i class="fas fa-check"></i> Concluir
                        </button>
                    </div>
                `;
                
                activeIncubationsContainer.appendChild(incubationCard);
            });
            
            // Configurar eventos dos bot√µes
            document.querySelectorAll('.incubation-actions button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const action = e.currentTarget.dataset.action;
                    const id = e.currentTarget.dataset.id;
                    
                    if (action === 'details') {
                        showIncubationDetails(id);
                    } else if (action === 'edit') {
                        showEditIncubation(id);
                    } else if (action === 'delete') {
                        deleteIncubation(id);
                    } else if (action === 'complete') {
                        completeIncubation(id);
                    }
                });
            });
        }

        // Mostrar detalhes da incuba√ß√£o
        function showIncubationDetails(id) {
            const incubation = incubations.find(inc => inc.id === id);
            if (!incubation) return;
            
            const species = speciesData.find(s => s.id === incubation.species);
            
            // Calcular dias passados
            const startDate = new Date(incubation.startDate);
            const currentDate = new Date();
            const daysPassed = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
            
            // Garantir que daysRemaining n√£o seja negativo
            let daysRemaining = Math.max(0, incubation.duration - daysPassed);
            
            // Calcular progresso
            let progress;
            if (incubation.duration > 0) {
                progress = Math.min(100, Math.floor(daysPassed / incubation.duration * 100));
            } else {
                progress = daysPassed > 0 ? 100 : 0;
            }
            
            // Formatar data de eclos√£o para exibi√ß√£o
            const hatchDate = new Date(incubation.hatchDate);
            const formattedHatchDate = hatchDate.toLocaleDateString('pt-BR');
            
            const content = document.getElementById('incubationDetailsContent');
            content.innerHTML = `
                <div class="form-group">
                    <p><strong>Lote:</strong> ${incubation.batchName}</p>
                    <p><strong>Esp√©cie:</strong> ${incubation.speciesIcon} ${incubation.speciesName}</p>
                    <p><strong>Quantidade de Ovos:</strong> ${incubation.eggQuantity}</p>
                    <p><strong>Data de In√≠cio:</strong> ${new Date(incubation.startDate).toLocaleDateString()}</p>
                    <p><strong>Data Prevista para Eclos√£o:</strong> ${formattedHatchDate}</p>
                    <p><strong>Dura√ß√£o:</strong> ${incubation.duration} dias</p>
                    <p><strong>Dias Passados:</strong> ${daysPassed}</p>
                    <p><strong>Dias Restantes:</strong> ${daysRemaining}</p>
                    <p><strong>Progresso:</strong> ${progress}%</p>
                    <p><strong>Temperatura Atual:</strong> ${incubation.currentTemp}¬∞C</p>
                    <p><strong>Umidade Atual:</strong> ${incubation.currentHumidity}%</p>
                    <p><strong>Status da Viragem:</strong> ${incubation.turningStatus ? 'Ativa' : 'Inativa'}</p>
                </div>
                
                <div class="form-group">
                    <h4>Par√¢metros:</h4>
                    <div class="incubation-params">
                        <span class="param-tag">${incubation.temperature}</span>
                        <span class="param-tag">${incubation.humidity}</span>
                        <span class="param-tag">${incubation.turning}</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>Est√°gios:</h4>
                    <div class="stages-list">
                        ${incubation.stages.map(stage => {
                            const isCompleted = daysPassed >= stage.day;
                            const isNotified = incubation.notifiedStages.includes(stage.day);
                            
                            return `
                                <div class="stage-item">
                                    <span class="stage-name">${stage.name}</span>
                                    <span class="stage-day">
                                        Dia ${stage.day}
                                        ${isCompleted ? '<i class="fas fa-check" style="color: var(--success-color); margin-left: 5px;"></i>' : ''}
                                        ${isNotified ? '<i class="fas fa-bell" style="color: var(--warning-color); margin-left: 5px;"></i>' : ''}
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            // Mostrar modal
            document.getElementById('incubationDetailsModal').classList.add('active');
            
            // Configurar eventos
            document.getElementById('incubationDetailsModalClose').addEventListener('click', () => {
                document.getElementById('incubationDetailsModal').classList.remove('active');
            });
            
            document.getElementById('incubationDetailsClose').addEventListener('click', () => {
                document.getElementById('incubationDetailsModal').classList.remove('active');
            });
        }

        // Mostrar formul√°rio de edi√ß√£o
        function showEditIncubation(id) {
            const incubation = incubations.find(inc => inc.id === id);
            if (!incubation) return;
            
            currentEditingIncubation = incubation;
            
            // Formatar data de eclos√£o para o input
            const hatchDate = new Date(incubation.hatchDate);
            const formattedHatchDate = hatchDate.toISOString().split('T')[0];
            
            const content = document.getElementById('editIncubationContent');
            content.innerHTML = `
                <form id="editIncubationForm">
                    <div class="form-group">
                        <label class="form-label" for="editBatchName">Nome do Lote:</label>
                        <input type="text" class="form-input" id="editBatchName" value="${incubation.batchName}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editEggQuantity">Quantidade de Ovos:</label>
                        <input type="number" class="form-input" id="editEggQuantity" min="1" value="${incubation.eggQuantity}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editStartDate">Data de In√≠cio:</label>
                        <input type="date" class="form-input" id="editStartDate" value="${new Date(incubation.startDate).toISOString().split('T')[0]}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editHatchDate">Data Prevista para Eclos√£o:</label>
                        <input type="date" class="form-input" id="editHatchDate" value="${formattedHatchDate}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editCurrentTemp">Temperatura Atual (¬∞C):</label>
                        <input type="number" class="form-input" id="editCurrentTemp" step="0.1" min="30" max="40" value="${incubation.currentTemp}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editCurrentHumidity">Umidade Atual (%):</label>
                        <input type="number" class="form-input" id="editCurrentHumidity" min="30" max="90" value="${incubation.currentHumidity}" required>
                    </div>
                </form>
            `;
            
            // Mostrar modal
            document.getElementById('editIncubationModal').classList.add('active');
            
            // Configurar eventos
            document.getElementById('editIncubationModalClose').addEventListener('click', () => {
                document.getElementById('editIncubationModal').classList.remove('active');
            });
            
            document.getElementById('editIncubationCancel').addEventListener('click', () => {
                document.getElementById('editIncubationModal').classList.remove('active');
            });
            
            document.getElementById('editIncubationSave').addEventListener('click', saveEditedIncubation);
        }

        // Salvar incuba√ß√£o editada
        function saveEditedIncubation() {
            if (!currentEditingIncubation) return;
            
            const batchName = document.getElementById('editBatchName').value;
            const eggQuantity = parseInt(document.getElementById('editEggQuantity').value);
            const startDate = document.getElementById('editStartDate').value;
            const hatchDate = document.getElementById('editHatchDate').value;
            const currentTemp = parseFloat(document.getElementById('editCurrentTemp').value);
            const currentHumidity = parseInt(document.getElementById('editCurrentHumidity').value);
            
            // Validar dados
            if (!batchName || !eggQuantity || !startDate || !hatchDate || isNaN(currentTemp) || isNaN(currentHumidity)) {
                showToast('Preencha todos os campos corretamente!', 'error');
                return;
            }
            
            // Atualizar incuba√ß√£o
            const incubationIndex = incubations.findIndex(inc => inc.id === currentEditingIncubation.id);
            if (incubationIndex !== -1) {
                incubations[incubationIndex].batchName = batchName;
                incubations[incubationIndex].eggQuantity = eggQuantity;
                incubations[incubationIndex].startDate = new Date(startDate).toISOString();
                incubations[incubationIndex].hatchDate = hatchDate;
                incubations[incubationIndex].currentTemp = currentTemp;
                incubations[incubationIndex].currentHumidity = currentHumidity;
                
                // Salvar no localStorage
                saveToLocalStorage();
                
                // Exibir notifica√ß√£o
                showToast('Incuba√ß√£o atualizada com sucesso!', 'success');
                
                // Fechar modal
                document.getElementById('editIncubationModal').classList.remove('active');
                
                // Renderizar incuba√ß√µes ativas
                renderActiveIncubations();
                
                // Renderizar monitor em tempo real
                renderRealtimeMonitor();
            }
            
            currentEditingIncubation = null;
        }

        // Excluir incuba√ß√£o
        function deleteIncubation(id) {
            if (confirm('Tem certeza que deseja excluir esta incuba√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.')) {
                const incubationIndex = incubations.findIndex(inc => inc.id === id);
                if (incubationIndex !== -1) {
                    incubations.splice(incubationIndex, 1);
                    
                    // Salvar no localStorage
                    saveToLocalStorage();
                    
                    // Exibir notifica√ß√£o
                    showToast('Incuba√ß√£o exclu√≠da com sucesso!', 'success');
                    
                    // Renderizar incuba√ß√µes ativas
                    renderActiveIncubations();
                    
                    // Renderizar monitor em tempo real
                    renderRealtimeMonitor();
                }
            }
        }

        // Concluir incuba√ß√£o
        function completeIncubation(id) {
            const incubationIndex = incubations.findIndex(inc => inc.id === id);
            if (incubationIndex === -1) return;
            
            // Marcar como inativa
            incubations[incubationIndex].active = false;
            incubations[incubationIndex].endDate = new Date().toISOString();
            
            // Salvar no localStorage
            saveToLocalStorage();
            
            // Exibir notifica√ß√£o
            showToast('Incuba√ß√£o conclu√≠da com sucesso!', 'success');
            
            // Renderizar incuba√ß√µes ativas
            renderActiveIncubations();
            
            // Renderizar monitor em tempo real
            renderRealtimeMonitor();
        }

        // Verificar notifica√ß√µes
        function checkNotifications() {
            const activeIncubations = incubations.filter(incubation => incubation.active);
            
            activeIncubations.forEach(incubation => {
                const startDate = new Date(incubation.startDate);
                const currentDate = new Date();
                const daysPassed = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
                
                // Verificar est√°gios que precisam de notifica√ß√£o
                incubation.stages.forEach(stage => {
                    if (daysPassed >= stage.day && !incubation.notifiedStages.includes(stage.day)) {
                        incubation.notifiedStages.push(stage.day);
                        saveToLocalStorage();
                        showToast(`${incubation.batchName}: ${stage.name}`, 'warning');
                        playNotificationSound();
                    }
                });
                
                // Verificar se a incuba√ß√£o foi conclu√≠da
                if (daysPassed >= incubation.duration && !incubation.notifiedStages.includes('completed')) {
                    incubation.notifiedStages.push('completed');
                    saveToLocalStorage();
                    showToast(`${incubation.batchName}: Incuba√ß√£o conclu√≠da!`, 'success');
                    playNotificationSound();
                }
                
                // Verificar alertas de temperatura e umidade
                if (incubation.currentTemp < 36 || incubation.currentTemp > 39) {
                    showToast(`${incubation.batchName}: Temperatura fora do ideal (${incubation.currentTemp}¬∞C)`, 'warning');
                }
                
                if (incubation.currentHumidity < 40 || incubation.currentHumidity > 80) {
                    showToast(`${incubation.batchName}: Umidade fora do ideal (${incubation.currentHumidity}%)`, 'warning');
                }
            });
        }

        // Tocar som de notifica√ß√£o
        function playNotificationSound() {
            sounds.notification.play();
        }

        // Tocar alarme alto
        function playHighAlarm(message) {
            const alarmIndicator = document.getElementById('alarmIndicator');
            const alarmMessage = document.getElementById('alarmMessage');
            alarmMessage.textContent = message || 'Alarme!';
            alarmIndicator.classList.add('active');
            
            document.getElementById('alarmStop').onclick = stopAlarm;
            
            sounds.alarm.play();
        }

        // Parar alarme
        function stopAlarm() {
            sounds.alarm.stop();
            const alarmIndicator = document.getElementById('alarmIndicator');
            alarmIndicator.classList.remove('active');
        }

        // Exibir notifica√ß√£o toast
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            if (type === 'error') icon = 'fa-times-circle';
            
            toast.innerHTML = `
                <i class="fas ${icon} toast-icon"></i>
                <div>${message}</div>
                <button class="toast-close" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Configurar evento de fechar
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.remove();
            });
            
            // Remover automaticamente ap√≥s 5 segundos
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        // Configurar eventos
        function setupEventListeners() {
            // Menu toggle
            document.getElementById('menuButton').addEventListener('click', toggleSidebar);
            
            // Sidebar links
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    const section = e.currentTarget.dataset.section;
                    if (section) {
                        e.preventDefault();
                        scrollToSection(section);
                        if (document.getElementById('sidebar').classList.contains('open')) {
                            toggleSidebar();
                        }
                    }
                });
            });
            
            // Link para trocar emoji
            document.getElementById('changeEmojiLink').addEventListener('click', (e) => {
                e.preventDefault();
                showChangeEmojiModal();
            });
            
            // Reset link
            document.getElementById('resetLink').addEventListener('click', (e) => {
                e.preventDefault();
                showResetModal();
            });
            
            // Modal de troca de emoji
            document.getElementById('changeEmojiModalClose').addEventListener('click', () => {
                document.getElementById('changeEmojiModal').classList.remove('active');
            });
            
            document.getElementById('changeEmojiCancel').addEventListener('click', () => {
                document.getElementById('changeEmojiModal').classList.remove('active');
            });
            
            document.getElementById('changeEmojiSave').addEventListener('click', saveSelectedEmoji);
            
            // Op√ß√µes de emoji
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    // Remover sele√ß√£o anterior
                    document.querySelectorAll('.emoji-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Adicionar sele√ß√£o ao emoji atual
                    e.currentTarget.classList.add('selected');
                    
                    // Armazenar emoji selecionado
                    selectedEmoji = e.currentTarget.dataset.emoji;
                });
            });
            
            // Reset modal
            document.getElementById('resetModalClose').addEventListener('click', () => {
                document.getElementById('resetModal').classList.remove('active');
            });
            
            document.getElementById('resetCancel').addEventListener('click', () => {
                document.getElementById('resetModal').classList.remove('active');
            });
            
            document.getElementById('resetConfirm').addEventListener('click', resetSystem);
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });
        }

        // Alternar sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Rolar para se√ß√£o
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Mostrar modal de troca de emoji
        function showChangeEmojiModal() {
            // Limpar sele√ß√£o anterior
            document.querySelectorAll('.emoji-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Selecionar emoji atual
            const currentOption = document.querySelector(`.emoji-option[data-emoji="${selectedEmoji}"]`);
            if (currentOption) {
                currentOption.classList.add('selected');
            }
            
            document.getElementById('changeEmojiModal').classList.add('active');
        }

        // Salvar emoji selecionado
        function saveSelectedEmoji() {
            // Verificar se algum emoji foi selecionado
            const selectedOption = document.querySelector('.emoji-option.selected');
            if (!selectedOption) {
                showToast('Por favor, selecione um emoji!', 'warning');
                return;
            }
            
            // Atualizar emoji
            selectedEmoji = selectedOption.dataset.emoji;
            
            // Salvar no localStorage
            saveToLocalStorage();
            
            // Atualizar logo
            updateLogoEmoji();
            
            // Fechar modal
            document.getElementById('changeEmojiModal').classList.remove('active');
            
            // Exibir notifica√ß√£o
            showToast('Emoji atualizado com sucesso!', 'success');
        }

        // Mostrar modal de reset
        function showResetModal() {
            document.getElementById('resetPassword').value = '';
            document.getElementById('resetModal').classList.add('active');
        }

        // Resetar sistema
        function resetSystem() {
            const password = document.getElementById('resetPassword').value;
            
            if (password === 'admin123') {
                showToast('Sistema resetado com sucesso! A p√°gina ser√° recarregada em instantes...', 'success');
                
                setTimeout(() => {
                    localStorage.clear();
                    location.reload();
                }, 800);
            } else {
                showToast('Senha incorreta!', 'error');
            }
        }
    </script>
</body>
</html>