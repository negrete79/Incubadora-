<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incubadora Digital - Gestão de Ovos de Aves</title>
    
    <!-- Meta tags para PWA -->
    <meta name="theme-color" content="#1e3a8a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Incubadora Digital">
    
    <!-- Ícones para PWA -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%231e3a8a' width='192' height='192'/><path fill='%2360a5fa' d='M96 40c-30.9 0-56 25.1-56 56s25.1 56 56 56 56-25.1 56-56-25.1-56-56-56zm0 96c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40z'/><circle fill='%2360a5fa' cx='96' cy='96' r='20'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%231e3a8a' width='192' height='192'/><path fill='%2360a5fa' d='M96 40c-30.9 0-56 25.1-56 56s25.1 56 56 56 56-25.1 56-56-25.1-56-56-56zm0 96c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40z'/><circle fill='%2360a5fa' cx='96' cy='96' r='20'/></svg>">
    
    <!-- Manifest para PWA -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkludWJhZG9yYSBEaWdpdGFsIiwKICAic2hvcnRfbmFtZSI6ICJJbnViYWRvcmEiLAogICJkZXNjcmlwdGlvbiI6ICJHaXN0w6NvIGRlIG92b3MgZGUgYXZlcyBwYXJhIGluY3ViYWRvcmEiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzFlM2E4YSIsCiAgInRoZW1lX2NvbG9yIjogIiMxZTNhOGEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDwvc3ZnPiIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    
    <!-- Fonte para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== VARIÁVEIS CSS E RESET ===== */
        :root {
            /* Tema Azul Mar (Claro) */
            --primary-color: #1e3a8a;
            --primary-light: #1e40af;
            --secondary-color: #3b82f6;
            --accent-color: #60a5fa;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --bg-color: #f0f9ff;
            --card-bg: #ffffff;
            --border-color: rgba(59, 130, 246, 0.2);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        /* Tema Escuro */
        [data-theme="dark"] {
            --primary-color: #0f172a;
            --primary-light: #1e293b;
            --secondary-color: #3b82f6;
            --accent-color: #60a5fa;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8fafc;
            --dark-color: #334155;
            --text-color: #f8fafc;
            --text-secondary: #94a3b8;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --border-color: rgba(99, 102, 241, 0.3);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ===== HEADER ===== */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo i {
            font-size: 2rem;
            color: var(--accent-color);
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .install-btn {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .install-btn.installed {
            background: linear-gradient(135deg, var(--text-secondary), #475569);
            cursor: default;
        }

        /* ===== PAINEL DE MONITORAMENTO ===== */
        .dashboard {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .dashboard-header h2 {
            color: var(--text-color);
            font-size: 1.5rem;
        }

        .refresh-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .refresh-btn:hover {
            background: var(--primary-light);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .dashboard-card {
            background: var(--bg-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .dashboard-card i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }

        .dashboard-card h3 {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .dashboard-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text-color);
        }

        .dashboard-card .status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-indicator.good {
            background-color: var(--success-color);
        }

        .status-indicator.warning {
            background-color: var(--warning-color);
        }

        .status-indicator.danger {
            background-color: var(--danger-color);
        }

        /* ===== BOTÃO ADICIONAR ===== */
        .add-btn-container {
            text-align: center;
            margin: 2rem 0;
        }

        .add-btn {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.4);
        }

        /* ===== CARDS DE REGISTROS ===== */
        .records-container {
            margin: 2rem 0;
        }

        .records-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .record-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
        }

        .record-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .record-species {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .record-species i {
            color: var(--secondary-color);
        }

        .record-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .icon-btn:hover {
            transform: scale(1.1);
        }

        .icon-btn.edit:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .icon-btn.delete:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .record-info {
            margin-top: 1rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .info-item i {
            width: 20px;
            color: var(--secondary-color);
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .hatch-date {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border-left: 3px solid var(--success-color);
            padding: 0.75rem;
            margin-top: 1rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hatch-date i {
            color: var(--success-color);
            font-size: 1.2rem;
        }

        .hatch-date-text {
            font-weight: 600;
            color: var(--text-color);
        }

        .hatch-date-value {
            margin-left: auto;
            background: var(--success-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .progress-container {
            margin-top: 1rem;
            height: 8px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
            border-radius: 4px;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: var(--text-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .close-btn:hover {
            color: var(--danger-color);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-color);
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--dark-color);
        }

        /* ===== ESTADO VAZIO ===== */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* ===== RESPONSIVO ===== */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .records-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-egg"></i>
                    <span>Incubadora Digital</span>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="install-btn" id="install-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        <span>Instalar App</span>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Painel de Monitoramento -->
        <div class="dashboard">
            <div class="dashboard-header">
                <h2>Painel de Monitoramento</h2>
                <button class="refresh-btn" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                    <span>Atualizar</span>
                </button>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <i class="fas fa-thermometer-half"></i>
                    <h3>Temperatura</h3>
                    <div class="value" id="temperature-value">--°C</div>
                    <div class="status">
                        <span class="status-indicator" id="temp-status"></span>
                        <span id="temp-status-text">--</span>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <i class="fas fa-tint"></i>
                    <h3>Umidade</h3>
                    <div class="value" id="humidity-value">--%</div>
                    <div class="status">
                        <span class="status-indicator" id="humidity-status"></span>
                        <span id="humidity-status-text">--</span>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <i class="fas fa-egg"></i>
                    <h3>Ovos em Incubação</h3>
                    <div class="value" id="eggs-count">0</div>
                    <div class="status">
                        <span class="status-indicator good"></span>
                        <span id="eggs-status-text">Nenhum</span>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <i class="fas fa-calendar-day"></i>
                    <h3>Próxima Eclosão</h3>
                    <div class="value" id="next-hatch">--</div>
                    <div class="status">
                        <span class="status-indicator" id="hatch-status"></span>
                        <span id="hatch-species">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="add-btn-container">
            <button class="add-btn" id="add-record-btn">
                <i class="fas fa-plus-circle"></i>
                <span>Adicionar Novo Registro</span>
            </button>
        </div>
        
        <div class="records-container">
            <div class="records-grid" id="records-grid">
                <!-- Cards serão gerados dinamicamente -->
            </div>
            
            <div class="empty-state" id="empty-state">
                <i class="fas fa-egg"></i>
                <h3>Nenhum registro encontrado</h3>
                <p>Adicione seu primeiro registro para começar a monitorar a incubação.</p>
            </div>
        </div>
    </div>
    
    <!-- Modal para Adicionar/Editar Registro -->
    <div class="modal" id="record-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Adicionar Registro</h2>
                <button class="close-btn" id="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="record-form">
                <div class="form-group">
                    <label for="species">Espécie da Ave</label>
                    <select id="species" required>
                        <option value="">Selecione uma espécie</option>
                        <option value="galinha">Galinha</option>
                        <option value="pato">Pato</option>
                        <option value="ganso">Ganso</option>
                        <option value="peru">Peru</option>
                        <option value="codorna">Codorna</option>
                        <option value="faisao">Faisão</option>
                        <option value="pavao">Pavão</option>
                        <option value="ema">Ema</option>
                        <option value="avestruz">Avestruz</option>
                        <option value="marreco">Marreco</option>
                        <option value="cisne">Cisne</option>
                        <option value="perdiz">Perdiz</option>
                        <option value="jacu">Jacu</option>
                        <option value="mutum">Mutum</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="start-date">Data de Início</label>
                    <input type="date" id="start-date" required>
                </div>
                
                <div class="form-group">
                    <label for="egg-count">Quantidade de Ovos</label>
                    <input type="number" id="egg-count" min="1" required placeholder="Ex: 12">
                </div>
                
                <div class="form-group">
                    <label for="temperature">Temperatura (°C)</label>
                    <input type="number" id="temperature" step="0.1" min="30" max="40" required placeholder="Ex: 37.5">
                </div>
                
                <div class="form-group">
                    <label for="humidity">Umidade (%)</label>
                    <input type="number" id="humidity" min="40" max="70" required placeholder="Ex: 60">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // ===== VARIÁVEIS GLOBAIS =====
        let records = [];
        let editingRecordId = null;
        let sensorData = {
            temperature: 37.5,
            humidity: 60
        };
        
        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar registros do localStorage
            loadRecords();
            
            // Configurar eventos
            setupEventListeners();
            
            // Iniciar sensores simulados
            startSensors();
            
            // Verificar PWA
            checkPWA();
        });
        
        // ===== PWA =====
        function checkPWA() {
            // Verificar se o navegador suporta PWA
            if ('serviceWorker' in navigator) {
                // Registrar service worker
                navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                    self.addEventListener('install', event => {
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', event => {
                        event.waitUntil(self.clients.claim());
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            fetch(event.request).catch(() => {
                                return new Response('Offline');
                            })
                        );
                    });
                `));
            }
            
            // Verificar botão de instalação
            const installBtn = document.getElementById('install-btn');
            
            // Evento beforeinstallprompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                installBtn.style.display = 'flex';
                
                installBtn.addEventListener('click', () => {
                    e.prompt();
                    e.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            installBtn.innerHTML = '<i class="fas fa-check"></i><span>Instalado</span>';
                            installBtn.classList.add('installed');
                        }
                        installBtn.style.display = 'none';
                    });
                });
            });
            
            // Verificar se já está instalado
            if (window.matchMedia('(display-mode: standalone)').matches) {
                installBtn.innerHTML = '<i class="fas fa-check"></i><span>Instalado</span>';
                installBtn.classList.add('installed');
            }
        }
        
        // ===== SENSORES SIMULADOS =====
        function startSensors() {
            // Atualizar sensores a cada 5 segundos
            setInterval(updateSensorData, 5000);
            
            // Atualizar interface imediatamente
            updateSensorData();
        }
        
        function updateSensorData() {
            // Simular variação de temperatura (±0.2°C)
            const tempVariation = (Math.random() - 0.5) * 0.4;
            sensorData.temperature = Math.max(36.0, Math.min(39.0, sensorData.temperature + tempVariation));
            
            // Simular variação de umidade (±2%)
            const humidityVariation = (Math.random() - 0.5) * 4;
            sensorData.humidity = Math.max(50, Math.min(70, sensorData.humidity + humidityVariation));
            
            // Arredondar valores
            sensorData.temperature = Math.round(sensorData.temperature * 10) / 10;
            sensorData.humidity = Math.round(sensorData.humidity);
            
            // Atualizar interface
            updateSensorDisplay();
        }
        
        function updateSensorDisplay() {
            // Atualizar temperatura
            document.getElementById('temperature-value').textContent = `${sensorData.temperature}°C`;
            
            // Atualizar umidade
            document.getElementById('humidity-value').textContent = `${sensorData.humidity}%`;
            
            // Verificar status da temperatura
            const tempStatus = document.getElementById('temp-status');
            const tempStatusText = document.getElementById('temp-status-text');
            
            if (sensorData.temperature >= 37.0 && sensorData.temperature <= 38.0) {
                tempStatus.className = 'status-indicator good';
                tempStatusText.textContent = 'Ideal';
            } else if (sensorData.temperature >= 36.5 && sensorData.temperature <= 38.5) {
                tempStatus.className = 'status-indicator warning';
                tempStatusText.textContent = 'Aceitável';
            } else {
                tempStatus.className = 'status-indicator danger';
                tempStatusText.textContent = 'Crítico';
            }
            
            // Verificar status da umidade
            const humidityStatus = document.getElementById('humidity-status');
            const humidityStatusText = document.getElementById('humidity-status-text');
            
            if (sensorData.humidity >= 55 && sensorData.humidity <= 65) {
                humidityStatus.className = 'status-indicator good';
                humidityStatusText.textContent = 'Ideal';
            } else if (sensorData.humidity >= 50 && sensorData.humidity <= 70) {
                humidityStatus.className = 'status-indicator warning';
                humidityStatusText.textContent = 'Aceitável';
            } else {
                humidityStatus.className = 'status-indicator danger';
                humidityStatusText.textContent = 'Crítico';
            }
        }
        
        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            // Botão Adicionar Registro
            document.getElementById('add-record-btn').addEventListener('click', () => {
                openModal();
            });
            
            // Botão Fechar Modal
            document.getElementById('close-modal').addEventListener('click', closeModal);
            
            // Botão Cancelar
            document.getElementById('cancel-btn').addEventListener('click', closeModal);
            
            // Formulário
            document.getElementById('record-form').addEventListener('submit', handleFormSubmit);
            
            // Botão Atualizar Painel
            document.getElementById('refresh-btn').addEventListener('click', () => {
                updateDashboard();
                updateSensorData();
            });
            
            // Troca de tema
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            
            // Clique fora do modal para fechar
            document.getElementById('record-modal').addEventListener('click', (e) => {
                if (e.target.id === 'record-modal') {
                    closeModal();
                }
            });
        }
        
        // ===== FUNÇÕES DO MODAL =====
        function openModal(recordId = null) {
            const modal = document.getElementById('record-modal');
            const modalTitle = document.getElementById('modal-title');
            const form = document.getElementById('record-form');
            
            // Resetar formulário
            form.reset();
            
            if (recordId) {
                // Editar registro
                editingRecordId = recordId;
                const record = records.find(r => r.id === recordId);
                
                modalTitle.textContent = 'Editar Registro';
                
                // Preencher formulário
                document.getElementById('species').value = record.species;
                document.getElementById('start-date').value = record.startDate;
                document.getElementById('egg-count').value = record.eggCount;
                document.getElementById('temperature').value = record.temperature;
                document.getElementById('humidity').value = record.humidity;
            } else {
                // Adicionar novo registro
                editingRecordId = null;
                modalTitle.textContent = 'Adicionar Registro';
                
                // Definir data atual como padrão
                document.getElementById('start-date').value = new Date().toISOString().split('T')[0];
                
                // Preencher com valores dos sensores
                document.getElementById('temperature').value = sensorData.temperature;
                document.getElementById('humidity').value = sensorData.humidity;
            }
            
            modal.classList.add('show');
        }
        
        function closeModal() {
            const modal = document.getElementById('record-modal');
            modal.classList.remove('show');
            editingRecordId = null;
        }
        
        // ===== FORMULÁRIO =====
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const species = document.getElementById('species').value;
            const startDate = document.getElementById('start-date').value;
            const eggCount = parseInt(document.getElementById('egg-count').value);
            const temperature = parseFloat(document.getElementById('temperature').value);
            const humidity = parseInt(document.getElementById('humidity').value);
            
            const recordData = {
                species,
                startDate,
                eggCount,
                temperature,
                humidity,
                createdAt: new Date().toISOString()
            };
            
            if (editingRecordId) {
                // Atualizar registro existente
                const index = records.findIndex(r => r.id === editingRecordId);
                records[index] = { ...records[index], ...recordData };
            } else {
                // Adicionar novo registro
                const newRecord = {
                    id: Date.now().toString(),
                    ...recordData
                };
                
                records.push(newRecord);
            }
            
            // Salvar no localStorage
            saveRecords();
            
            // Atualizar interface
            renderRecords();
            updateDashboard();
            
            // Fechar modal
            closeModal();
        }
        
        // ===== RENDERIZAÇÃO =====
        function renderRecords() {
            const recordsGrid = document.getElementById('records-grid');
            const emptyState = document.getElementById('empty-state');
            
            // Limpar grid
            recordsGrid.innerHTML = '';
            
            if (records.length === 0) {
                // Mostrar estado vazio
                emptyState.style.display = 'block';
                return;
            }
            
            // Esconder estado vazio
            emptyState.style.display = 'none';
            
            // Renderizar cada registro
            records.forEach(record => {
                const recordCard = createRecordCard(record);
                recordsGrid.appendChild(recordCard);
            });
        }
        
        function createRecordCard(record) {
            const card = document.createElement('div');
            card.className = 'record-card';
            card.dataset.id = record.id;
            
            // Calcular dias restantes
            const startDate = new Date(record.startDate);
            const currentDate = new Date();
            const daysPassed = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
            
            // Diferentes períodos de incubação por espécie
            const incubationDays = {
                'galinha': 21,
                'pato': 28,
                'ganso': 30,
                'peru': 28,
                'codorna': 17,
                'faisao': 23,
                'pavao': 28,
                'ema': 40,
                'avestruz': 42,
                'marreco': 28,
                'cisne': 35,
                'perdiz': 24,
                'jacu': 24,
                'mutum': 21
            };
            
            const daysForSpecies = incubationDays[record.species] || 21;
            const daysRemaining = Math.max(0, daysForSpecies - daysPassed);
            const progress = Math.min(100, (daysPassed / daysForSpecies) * 100);
            
            // Calcular data prevista de eclosão
            const hatchDate = new Date(startDate);
            hatchDate.setDate(hatchDate.getDate() + daysForSpecies);
            
            // Obter ícone da espécie
            const speciesIcon = getSpeciesIcon(record.species);
            
            card.innerHTML = `
                <div class="record-header">
                    <div class="record-species">
                        <i class="${speciesIcon}"></i>
                        <span>${capitalizeFirst(record.species)}</span>
                    </div>
                    <div class="record-actions">
                        <button class="icon-btn edit" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn delete" title="Excluir">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="record-info">
                    <div class="info-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span><span class="info-label">Início:</span> ${formatDate(record.startDate)}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-egg"></i>
                        <span><span class="info-label">Ovos:</span> ${record.eggCount}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-thermometer-half"></i>
                        <span><span class="info-label">Temp:</span> ${record.temperature}°C</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-tint"></i>
                        <span><span class="info-label">Umidade:</span> ${record.humidity}%</span>
                    </div>
                </div>
                
                <div class="hatch-date">
                    <i class="fas fa-calendar-check"></i>
                    <div>
                        <div class="hatch-date-text">Previsão de Eclosão</div>
                        <div>${formatDate(hatchDate.toISOString().split('T')[0])}</div>
                    </div>
                    <div class="hatch-date-value">${daysRemaining}d</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" style="width: ${progress}%;"></div>
                </div>
            `;
            
            // Adicionar eventos aos botões
            const editBtn = card.querySelector('.edit');
            const deleteBtn = card.querySelector('.delete');
            
            editBtn.addEventListener('click', () => {
                openModal(record.id);
            });
            
            deleteBtn.addEventListener('click', () => {
                deleteRecord(record.id);
            });
            
            return card;
        }
        
        // ===== FUNÇÕES AUXILIARES =====
        function getSpeciesIcon(species) {
            const icons = {
                'galinha': 'fas fa-egg',
                'pato': 'fas fa-duck',
                'ganso': 'fas fa-dove',
                'peru': 'fas fa-kiwi-bird',
                'codorna': 'fas fa-feather',
                'faisao': 'fas fa-crow',
                'pavao': 'fas fa-feather-alt',
                'ema': 'fas fa-horse',
                'avestruz': 'fas fa-horse',
                'marreco': 'fas fa-duck',
                'cisne': 'fas fa-dove',
                'perdiz': 'fas fa-dove',
                'jacu': 'fas fa-crow',
                'mutum': 'fas fa-crow'
            };
            
            return icons[species] || 'fas fa-egg';
        }
        
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }
        
        // ===== ARMAZENAMENTO =====
        function saveRecords() {
            localStorage.setItem('incubation-records', JSON.stringify(records));
        }
        
        function loadRecords() {
            const savedRecords = localStorage.getItem('incubation-records');
            if (savedRecords) {
                records = JSON.parse(savedRecords);
                renderRecords();
            }
        }
        
        // ===== EXCLUSÃO =====
        function deleteRecord(recordId) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                records = records.filter(r => r.id !== recordId);
                saveRecords();
                renderRecords();
                updateDashboard();
            }
        }
        
        // ===== PAINEL DE MONITORAMENTO =====
        function updateDashboard() {
            // Calcular estatísticas
            const totalEggs = records.reduce((sum, record) => sum + record.eggCount, 0);
            
            // Atualizar UI
            document.getElementById('eggs-count').textContent = totalEggs;
            
            const eggsStatusText = document.getElementById('eggs-status-text');
            if (totalEggs === 0) {
                eggsStatusText.textContent = 'Nenhum';
            } else if (totalEggs < 10) {
                eggsStatusText.textContent = 'Poucos';
            } else {
                eggsStatusText.textContent = 'Vários';
            }
            
            // Encontrar próximo a eclodir
            if (records.length > 0) {
                // Calcular dias restantes para cada registro
                const recordsWithDaysLeft = records.map(record => {
                    const startDate = new Date(record.startDate);
                    const currentDate = new Date();
                    const daysPassed = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
                    
                    const incubationDays = {
                        'galinha': 21,
                        'pato': 28,
                        'ganso': 30,
                        'peru': 28,
                        'codorna': 17,
                        'faisao': 23,
                        'pavao': 28,
                        'ema': 40,
                        'avestruz': 42,
                        'marreco': 28,
                        'cisne': 35,
                        'perdiz': 24,
                        'jacu': 24,
                        'mutum': 21
                    };
                    
                    const daysForSpecies = incubationDays[record.species] || 21;
                    const daysLeft = Math.max(0, daysForSpecies - daysPassed);
                    
                    return {
                        ...record,
                        daysLeft
                    };
                });
                
                // Encontrar o registro com menos dias restantes
                const nextRecord = recordsWithDaysLeft.reduce((prev, current) => {
                    return prev.daysLeft < current.daysLeft ? prev : current;
                });
                
                const hatchStatus = document.getElementById('hatch-status');
                const hatchSpecies = document.getElementById('hatch-species');
                
                if (nextRecord.daysLeft === 0) {
                    document.getElementById('next-hatch').textContent = 'Hoje!';
                    hatchStatus.className = 'status-indicator good';
                    hatchSpecies.textContent = capitalizeFirst(nextRecord.species);
                } else if (nextRecord.daysLeft <= 3) {
                    document.getElementById('next-hatch').textContent = `${nextRecord.daysLeft} dias`;
                    hatchStatus.className = 'status-indicator warning';
                    hatchSpecies.textContent = capitalizeFirst(nextRecord.species);
                } else {
                    document.getElementById('next-hatch').textContent = `${nextRecord.daysLeft} dias`;
                    hatchStatus.className = 'status-indicator good';
                    hatchSpecies.textContent = capitalizeFirst(nextRecord.species);
                }
            } else {
                document.getElementById('next-hatch').textContent = '--';
                document.getElementById('hatch-status').className = 'status-indicator';
                document.getElementById('hatch-species').textContent = '--';
            }
        }
        
        // ===== TEMA =====
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Carregar tema salvo
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i>';
        }
    </script>
</body>
</html>